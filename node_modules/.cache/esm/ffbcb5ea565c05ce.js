let express,Campground,Comment;_565‍.x([["default",()=>_565‍.o]]);_565‍.w("express",[["default",["express"],function(v){express=v}]]);_565‍.w("../views/models/campground",[["default",["Campground"],function(v){Campground=v}]]);_565‍.w("../views/models/comment",[["default",["Comment"],function(v){Comment=v}]]);
const router = express.Router()





//================================
// COMMENTS ROUTES
//NEW - show form 
router.get('/campgrounds/:id/comments/new', isLoggedIn, (req, res) => {
    Campground.findById(req.params.id, (err, foundCampground) => {
        err ? _565‍.g.console.log(err)
            :
            res.render('./comments/new', { campground: foundCampground })
    })
})
//CREATE - create comment and save it to DB
router.post('/campgrounds/:id/comments', isLoggedIn, (req, res) => {
    Campground.findById(req.params.id, (err, campground) => {
        err ? _565‍.g.console.log(err)
            :
            Comment.create({
                text: req.body.newText,
                author: req.body.newAuthor,
            }, (err, comment) => {
                err ? _565‍.g.console.log(err)
                    :
                    campground.comments.push(comment)
                campground.save()
                res.redirect('/campgrounds/' + campground._id)
            })
    })
})

//middleware - check if user is loggedin before access to secret page
function isLoggedIn(req, res, next) {
    if (req.isAuthenticated()) {
        return next();
    }
    res.redirect("/login");
}

_565‍.d(router);